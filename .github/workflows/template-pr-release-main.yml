name: "Template - PR Release ‚Üí Main"

on:
  workflow_call:
    secrets:
      GH_TOKEN:
        required: true

permissions:
  contents: write
  pull-requests: write

jobs:
  pr-release-main:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GH_TOKEN }}
          fetch-depth: 0

      - name: Get version from .version file
        id: version
        run: |
          VERSION=$(sed 's/-RELEASE//' .version)
          echo "version=$VERSION" >> "$GITHUB_OUTPUT"

      - name: Create PR to main
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          BRANCH_NAME: ${{ github.ref_name }}
          VERSION: ${{ steps.version.outputs.version }}
        run: |
          EXISTING_PR=$(gh pr list --base main --head "$BRANCH_NAME" --state open --json number --jq '.[0].number')
          
          if [ -z "$EXISTING_PR" ]; then
            gh pr create \
              --base main \
              --head "$BRANCH_NAME" \
              --title "üöÄ Release v$VERSION ‚Üí main" \
              --body "## üöÄ Release v$VERSION
              
          **Vers√£o:** \`$VERSION\`  
          **Branch:** \`$BRANCH_NAME\`  
          **Target:** \`main\`
          
          ---
          _PR autom√°tico da branch de release para main_"
            echo "‚úÖ PR criado com sucesso!"
          else
            echo "‚ö†Ô∏è PR #$EXISTING_PR j√° existe"
          fi